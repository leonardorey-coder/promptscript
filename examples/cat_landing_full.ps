log("üêæ Workflow: Landing page completa de gatos")

# -----------------------------
# Config LLM
# -----------------------------
devConfig = {
  provider: "openrouter",
  apiKey: "OPENROUTER_API_KEY",
  model: "mistralai/devstral-2512:free",
  no_ask: true,
  maxTokens: 16384,
}

dev = LLMClient(devConfig)

memory_key = "landing.cats.v1"

# -----------------------------
# 0) Recon del proyecto (determinista)
# -----------------------------
log("Recon: buscando estructura del proyecto...")
files = apply("SEARCH", { query: "", globs: ["public/**", "src/**", "package.json", "README.md"], maxResults: 200 })

# Si ya existe public/, ok; si no, el agente la crear√° con WRITE_FILE.
# Nota: tu WRITE_FILE crea rutas intermedias? Si no, agrega tool MKDIR o usa RUN_CMD mkdir (si lo permites).

# -----------------------------
# 1) Crear base HTML/CSS/JS (estructura completa)
# -----------------------------
log("Paso 1: Generando base (index.html, styles.css, app.js)...")

run_agent(dev,
  "Crea una landing page COMPLETA y PROFESIONAL de gatos.\n" +
  "Requisitos:\n" +
  "- Archivos: public/index.html, public/styles.css, public/app.js\n" +
  "- En index.html: header con nav, hero, secci√≥n de features, secci√≥n de galer√≠a/carrusel, secci√≥n FAQ, CTA final y footer.\n" +
  "- Carrusel: botones prev/next + dots + soporte teclado; accesibilidad con aria-labels.\n" +
  "- En styles.css: dise√±o moderno, responsive (mobile-first), tipograf√≠a limpia, buenas jerarqu√≠as, y carrusel bonito.\n" +
  "- En app.js: l√≥gica del carrusel (transform translateX), dots, teclado (‚Üê ‚Üí), y opcional autoplay con pausa al hover.\n" +
  "- No uses frameworks; puro HTML/CSS/JS.\n" +
  "- Aseg√∫rate de referenciar styles.css y app.js desde index.html.\n" +
  "- Termina con un REPORT done=true e incluye filesChanged.\n",
  { memory_key: memory_key, require_write: true }
)

# -----------------------------
# 2) Integrar im√°genes del proyecto si existen
# -----------------------------
log("Paso 2: Integrando im√°genes si existen en public/images o images/...")

imgHits = apply("SEARCH", { query: "", globs: ["public/images/**", "images/**"], maxResults: 50 })

# Si hay im√°genes, p√≠dele al agente que las use. Si no, que use placeholders bonitos.
run_agent(dev,
  "Lee public/index.html y adapta la secci√≥n de carrusel/galer√≠a:\n" +
  "- Si existen im√°genes en public/images/** o images/** (seg√∫n el listado previo), √∫salas como <img> reales.\n" +
  "- Si no hay im√°genes, usa placeholders elegantes (gradientes + emojis) pero deja estructura lista para poner im√°genes despu√©s.\n" +
  "- Mant√©n accesibilidad: alt text descriptivo.\n" +
  "- Mant√©n el carrusel funcionando con app.js.\n" +
  "- Termina con REPORT done=true y filesChanged.\n",
  { memory_key: memory_key, require_write: true }
)

# -----------------------------
# 3) QA: Validaci√≥n y mejora (accesibilidad + responsive + limpieza)
# -----------------------------
log("Paso 3: QA (accesibilidad, responsive, performance)...")

run_agent(dev,
  "QA sobre la landing:\n" +
  "- Revisa public/index.html, public/styles.css, public/app.js.\n" +
  "- Mejora accesibilidad (aria, focus states, contraste, navegaci√≥n teclado).\n" +
  "- Mejora responsive (breakpoints, tama√±os, spacing).\n" +
  "- Evita c√≥digo duplicado y deja comentarios m√≠nimos √∫tiles.\n" +
  "- No rompas el carrusel.\n" +
  "- Termina con REPORT done=true y filesChanged.\n",
  { memory_key: memory_key, require_write: true }
)

# -----------------------------
# 4) (Opcional) Ejecutar build/test si existe (solo si lo permites)
# -----------------------------
log("Paso 4: (Opcional) Intentando correr tests si existen scripts...")

pkgExists = apply("SEARCH", { query: "", globs: ["package.json"], maxResults: 1 })

if len(pkgExists) > 0:
  pkg = apply("READ_FILE", { path: "package.json", maxBytes: 200000 })
  
  run_agent(dev,
    "El proyecto tiene package.json. Revisa si hay scripts √∫tiles para validar (build o test).\n" +
    "Reglas:\n" +
    "- Si no est√°s seguro, NO ejecutes comandos.\n" +
    "- Si decides ejecutar, usa RUN_CMD con timeout <= 60000.\n" +
    "- Si falla, arregla lo m√≠nimo necesario en public/*.\n" +
    "- Termina con REPORT done=true.\n",
    { memory_key: memory_key, require_write: false }
  )
else:
  log("No se encontr√≥ package.json. Saltando validaci√≥n de scripts.")
  do("Reporta que no se encontr√≥ package.json en el proyecto y que la landing page fue creada sin scripts de build/test. Usa REPORT con done=true.")

# -----------------------------
# 5) Reporte final ‚Äúbonito‚Äù
# -----------------------------
log("Paso 5: Reporte final")

do("Genera un reporte final indicando que la landing de gatos est√° completa y refinada. " +
  "Incluye en el REPORT: " +
  "- message: 'Landing de gatos completa creada y refinada.' " +
  "- filesChanged: ['public/index.html', 'public/styles.css', 'public/app.js'] " +
  "- nextSuggestions: ['Agregar im√°genes reales en public/images y actualizar alt text', 'Agregar analytics/SEO (meta tags OG/Twitter)', 'Agregar test E2E (Playwright) para carrusel y navegaci√≥n'] " +
  "- done: true")

log("‚úÖ Workflow finalizado")